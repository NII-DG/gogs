## データガバナンス機能の制限事項

### 注意事項<!-- omit in toc -->

- 現在のシステムは試行版です。GIN-forkや実験環境以外の、自分で管理できる場所に実験データのバックアップをお願い致します。<br>
- 現環境ではPythonでのみ実験を実行いただけます。<br>
- GIN-forkでリポジトリを操作するとエラー画面(404や500エラー)が表示されることがあります。1~2分時間を置いてから再度お試しください。解決しない場合はサポートへ問い合わせるようにお願い致します。<br>
- ユーザー情報の個人URLにORCIDを入力しない場合、「メタデータを検証する」タスクで「メタデータに不備が見つかりました」と表示されます。<br>
- 実験実行環境の初期セットアップを終えていない場合、「メタデータを検証する」タスクでエラーが表示されます。<br>
- 現在システムで作成したDMPを実際に提出することはありませんが、任意の提出機関を選んでDMPを作成してください。<br>
- サポートについては、[ユーザーマニュアル](https://support.rdm.nii.ac.jp/usermanual/)からデータガバナンス機能の問い合わせをご覧ください。<br>

### 必須事項<!-- omit in toc -->
- 現状、研究リポジトリは公開する必要があります。そのため、現段階のシステムではデータの機密性は守られません。<br>
- 実行環境の構築はDockerfileで行ってください。<br>

### 禁止事項<!-- omit in toc -->
- 実行環境を構築している状態では、GIN-fork上でリポジトリの削除・ファイルの更新等は行わないでください。<br>
- 実験パッケージ作成後、実験パッケージの削除・名前の変更等は行わないでください。<br>
- maDMP.ipynbの作成後、dmp.jsonの編集は行わないでください。<br>
- 現在、GIN-forkでは複数ブランチでのリポジトリ操作をサポートしておりません。実行環境においてリポジトリのブランチの作成・操作を行わないでください。複数ブランチのサポートについては今後改善予定です。<br>


## リサーチフロー実行環境を準備する

リサーチフローを実行する環境を構築するための準備を行います。<br>

1. DMPの選択

    画面右上の「AddDMP」からDMPの提出先を選択してください。<br>
    Add DMPボタンは、DMPの種類を選ぶことができるプルダウンになっています。<br>
    現在システムで作成したDMPを実際に提出することはありませんが、任意の提出機関を選んでDMPを作成してください。<br>

    以下は選択できるDMPの種類です。<br>
    - amed : 国立研究開発法人日本医療研究開発機構(AMED) のDMP<br>
    - jst : 国立研究開発法人科学技術振興機構(JST) のDMP<br>
    - meti : 経済産業省(METI) のDMP<br>
    - moonshot : 内閣府が定めている公的資金による研究データの管理・利活用におけるメタデータの共通項目<br>

2. DMPの作成

    Add DMPボタンから提出先を選択すると、DMPの編集画面に遷移します。<br>
    DMPに必要な情報を入力<sup>※1</sup> してください。DMPの種類については、DMPの項目の「schema」の値をご覧ください。<br>
    入力が完了したら、「変更をコミット」ボタンを押してください。押下後、dmp.jsonが生成され、ファイルの内容が表示されます。<br>
    （注） dmp.jsonのファイル名・ファイルパスは変更しないでください。<br>

    作成したDMPを編集する際は「Edit DMP JSON」ボタンを押下してください。<br>
    DMPの内容はリポジトリトップのREADME.mdの下に表示されます。こちらでは表形式で確認できます。<br>

    ※1 : DMP情報には、実行環境の構築方法が含まれます。<br>
    構築方法として、Dockerfile による構築手段が提供されています。また、Dockerfileはカスタマイズすることもできます。詳細は、4.の手順を参照してください。<br>

3. maDMPの生成

    （注） この操作以降、DMPを編集してもリサーチフローに取り込まれません。DMPの内容を変更したい場合はリポジトリの作成からやり直してください。<br>

    DMPの作成が終わったら、画面右上に出てくる「Generate maDMP」ボタンをクリックしてください。クリックすると自動的にREADME.mdへと戻ります。<br>
    このとき、以下のファイルが生成されます。<br>

    - maDMP.ipynb : コンピュータが実行可能なDMP<br>
    - Dockerfile : 環境構成ファイル<br>

    作成したmaDMPは画面右上にある「View maDMP」から確認できます。<br>

4. 環境構成ファイルのカスタマイズ

    ここまでで、デフォルトのDockerfileがあなたのリポジトリの最上位で確認できます。<br>
    もし、構築時、事前にインストールしたいパッケージがある場合はDockerfileに追記してください。<br>
    ただし、Dockerfileを更新する際の**注意事項**があります。<br>

    ・ **注意事項**<br>
    以下の注意事項を守ってDockerfileを更新してください。誤った更新を行うと正常なリサーチフロー機能が提供できなくなる恐れがあります。<br>
    a. Dockerfileには、ユーザ独自の記述ができるエリア(ユーザカスタムエリア)を用意しています（以下の写真）。ユーザカスタムエリアのStratとEndの間に記述するようにしてください。<br>
    b. ユーザカスタムエリア外の 既存の記述コードは編集しないでください。<br>
    c. Dockerfileの位置は変更しないでください。<br>

    ![ユーザカスタムエリア](./images/user_custom_area.png)<br>


5. 実行環境へ遷移

    maDMPの生成後に画面右上に出てくる「launch binder」ボタンをクリックしてください。<br>
    ボタンを押下するとリサーチフローの実行環境の構築が開始されます。この処理には時間がかかります。<br>
    構築時にエラーになってしまった場合は、[ユーザーマニュアル](https://support.rdm.nii.ac.jp/usermanual/)からデータガバナンス機能のFAQをご覧ください。<br>
    <br>
    ![](./images/binder_launching.png)<br>
    <br>
    ログイン画面が表示された場合はGakuNin IdPアカウントでログインしてください。<br>
    <br>
    ![IdP選択](./images/login_IdP.png)<br>
    <br>
    構築に成功すると自動的にmaDMP.ipynbが表示されます。<br>
    <br>
    ![maDMP](./images/maDMP.png)<br>

