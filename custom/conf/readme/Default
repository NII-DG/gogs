## リサーチフロー実行環境を準備する

リサーチフローを実行する環境を構築するための準備を行います。<br>

1. DMPの選択

    画面右上の「AddDMP」からDMPの提出先を選択してください。<br>
    Add DMPボタンは、DMPの種類を選ぶことができるプルダウンになっています。<br>
    試行ユーザー版では、実際にDMPを提出することはありませんが、任意の種類を選択してDMPを作成してください。<br>

    以下は選択できるDMPの種類です。<br>
    - amed : 国立研究開発法人日本医療研究開発機構(AMED) のDMP<br>
    - jst : 国立研究開発法人科学技術振興機構(JST) のDMP<br>
    - meti : 経済産業省(METI) のDMP<br>
    - moonshot : 内閣府が定めている公的資金による研究データの管理・利活用におけるメタデータの共通項目<br>

2. DMPの作成

    Add DMPボタンから提出先を選択すると、DMPの編集画面に遷移します。<br>
    DMPに必要な情報を入力<sup>※1</sup> してください。DMPの種類については、DMPの項目の「schema」の値をご覧ください。<br>
    入力が完了したら、「変更をコミット」ボタンを押してください。押下後、dmp.jsonが生成され、ファイルの内容が表示されます。<br>
    （注） dmp.jsonのファイル名・ファイルパスは変更しないでください。<br>

    作成したDMPを編集する際は「Edit DMP JSON」ボタンを押下してください。<br>
    DMPの内容はリポジトリトップのREADME.mdの下に表示されます。こちらでは表形式で確認できます。<br>

    ※1 : DMP情報には、実行環境の構築方法が含まれます。<br>
    構築方法として、Dockerfile による構築手段が提供されています。また、Dockerfileはカスタマイズすることもできます。詳細は、4.の手順を参照してください。<br>

3. maDMPの生成

    （注） この操作以降、DMPを編集してもリサーチフローに取り込まれません。DMPの内容を変更したい場合はリポジトリの作成からやり直してください。<br>

    DMPの作成が終わったら、画面右上に出てくる「Generate maDMP」ボタンをクリックしてください。クリックすると自動的にREADME.mdへと戻ります。<br>
    このとき、以下のファイルが生成されます。<br>

    - maDMP.ipynb : コンピュータが実行可能なDMP<br>
    - Dockerfile : 環境構成ファイル<br>

    作成したmaDMPは画面右上にある「View maDMP」から確認できます。<br>

4. 環境構成ファイルのカスタマイズ

    ここまでで、デフォルトのDockerfileがあなたのリポジトリの最上位で確認できます。<br>
    もし、構築時、事前にインストールしたいパッケージがある場合はDockerfileに追記してください。<br>
    ただし、Dockerfileを更新する際の**注意事項**があります。<br>

    ・ **注意事項**<br>
    以下の注意事項を守ってDockerfileを更新してください。誤った更新を行うと正常なリサーチフロー機能が提供できなくなる恐れがあります。<br>
    a. Dockerfileには、ユーザ独自の記述ができるエリア(ユーザカスタムエリア)を用意しています（以下の写真）。ユーザカスタムエリアのStratとEndの間に記述するようにしてください。<br>
    b. ユーザカスタムエリア外の 既存の記述コードは編集しないでください。<br>
    c. Dockerfileの位置は変更しないでください。<br>

    ![ユーザカスタムエリア](./images/user_custom_area.png)<br>


5. 実行環境へ遷移

    maDMPの生成後に画面右上に出てくる「launch binder」ボタンをクリックしてください。<br>
    ボタンを押下するとリサーチフローの実行環境の構築が開始されます。この処理には時間がかかります。<br>
    構築時にエラーになってしまった場合は、[ユーザーマニュアル](https://support.rdm.nii.ac.jp/usermanual/)からデータガバナンス機能のFAQをご覧ください。<br>
    <br>
    ![](./images/binder_launching.png)<br>
    <br>
    ログイン画面が表示された場合はGakuNin IdPアカウントでログインしてください。<br>
    <br>
    ![IdP選択](./images/login_IdP.png)<br>
    <br>
    構築に成功すると自動的にmaDMP.ipynbが表示されます。<br>
    <br>
    ![maDMP](./images/maDMP.png)<br>

    